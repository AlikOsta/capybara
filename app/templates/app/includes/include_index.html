
{% load cache %}

{% block content %}
<div class="mt-3">

  {# Кешируем шапку с категориями и баннерами #}
  {% cache 300 homepage_header %}
    {% include 'app/includes/category.html' %}
    {% include 'app/includes/banner.html' %}
  {% endcache %}

  {# Заголовок #}
  <div class="d-flex align-items-center mb-3">
    <h5 class="fw-bold text-primary">Новые объявления</h5>
    <span class="ms-2 badge bg-light text-dark rounded-pill">{{ total_count }}</span>
  </div>

  {# Контейнер продуктов и skeleton #}
  <div id="products-container" class="row g-3">
    {% for product in products %}
      <div class="col-6 product-item">
        {% include 'app/includes/product_card.html' with product=product %}
      </div>
    {% empty %}
      <div class="col-12 text-center py-5">
        <i class="bi bi-inbox fs-1 text-muted mb-3"></i>
        <p class="text-muted">Объявления не найдены</p>
      </div>
    {% endfor %}
  </div>

  {# Lazy load следующей страницы #}
  {% if products.has_next %}
  <div hx-get="{% url 'app:product_list' %}?page={{ products.next_page_number }}"
       hx-trigger="revealed"
       hx-target="#products-container"
       hx-swap="afterend"
       class="load-more-trigger">
    </div>
  {% endif %}

  {# Ошибка загрузки #}
  <div id="error-message" class="text-center py-4">
    <p class="text-danger mb-2">Не удалось загрузить объявления</p>
    <button id="retry-button" class="btn btn-outline-primary">Попробовать снова</button>
  </div>

  {# Кнопка "Вверх" #}
    <button id="back-to-top" class="btn btn-primary rounded-circle position-fixed" style="display: none;">
    <i class="bi bi-arrow-up"></i>
    </button>

</div>


{% endblock %}

{% block scripts %}
{% endblock %}
